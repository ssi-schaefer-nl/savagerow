{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\vincent\\\\git\\\\playground\\\\src\\\\Components\\\\Tables\\\\SavageTable.js\";\nimport React from \"react\";\nimport DataGrid, { TextEditor } from \"react-data-grid\";\nimport \"./styles.css\";\nimport './react-contextmenu.css';\nimport TableDataService from '../../Service/TableDataServices';\nimport { CircularProgress } from \"@material-ui/core\";\nimport { Colorize } from \"@material-ui/icons\";\nimport Alert from '@material-ui/lab/Alert';\nimport IconButton from '@material-ui/core/IconButton';\nimport Collapse from '@material-ui/core/Collapse';\nimport Button from '@material-ui/core/Button';\nimport CloseIcon from '@material-ui/icons/Close';\nimport Menu from '@material-ui/core/Menu';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport Typography from '@material-ui/core/Typography';\nimport CollapsableAlert from \"../CollapsableAlert/CollapsableAlert\";\nimport ContentWithContextMenu from \"../ContentWithContextMenu/ContentWithContextMenu\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nclass SavageTable extends React.Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      rows: [],\n      rowStagedForInsertion: -1,\n      newRows: [],\n      columns: [],\n      loading: true,\n      selectedRow: null,\n      alert: null,\n      tableDataService: new TableDataService(),\n      mouseX: null,\n      mouseY: null\n    };\n\n    this.loadTableData = () => {\n      this.state.tableDataService.getTableData(this.props.table, function (data) {\n        this.setState({\n          columns: this.createColumns(data.data.tableSchema.columns)\n        });\n        this.setState({\n          rows: data.data.data\n        });\n        this.setState({\n          loading: false\n        });\n        var emptyRow = {};\n        this.state.columns.forEach(col => {\n          emptyRow[col.key] = \"\";\n        });\n        var data = this.state.rows;\n        var idx = data.push(emptyRow) - 1;\n        this.setState({\n          rows: data,\n          newRows: [idx]\n        });\n      }.bind(this), function (data) {\n        console.log(data);\n        this.setState({\n          loading: false\n        });\n      }.bind(this));\n    };\n\n    this.handleClick = event => {\n      event.preventDefault();\n      this.setState({\n        mouseX: event.clientX - 2,\n        mouseY: event.clientY - 4\n      });\n    };\n\n    this.handleClose = () => {\n      var initialState = {\n        mouseX: null,\n        mouseY: null\n      };\n      this.setState(initialState);\n    };\n\n    this.saveSelectRowManually = () => {\n      if (this.rowStagedForInsertHasAllData()) {\n        this.addRow(this.state.rowStagedForInsertion);\n      }\n    };\n\n    this.handleCellChange = c => {\n      console.log(c);\n\n      if (this.shouldProcessStagedRowInsert(c.rowIdx)) {\n        console.log(\"Changed row selection and a row is staged for insertion\");\n        this.addRow(this.state.rowStagedForInsertion);\n      }\n\n      this.state.selectedRow = c.rowIdx;\n    };\n\n    this.insertEmptyRow = () => {\n      var idx = this.state.selectedRow;\n      var emptyRow = {};\n      this.state.columns.forEach(col => {\n        emptyRow[col.key] = \"\";\n      });\n      var data = this.state.rows;\n      data.splice(idx, 0, emptyRow); //Insert empty row at index idx\n\n      this.state.newRows.push(idx);\n      this.setState({\n        rows: data\n      });\n    };\n\n    this.deleteRow = () => {\n      var idx = this.state.selectedRow;\n      var data = {\n        row: this.state.rows[idx]\n      };\n\n      if (this.state.newRows.includes(idx)) {\n        var data = this.state.rows;\n        data.splice(idx, 1);\n        this.setState({\n          rows: data\n        });\n      } else {\n        this.state.tableDataService.deleteTableData(this.props.table, data, function (data) {\n          var data = this.state.rows;\n          data.splice(idx, 1);\n          this.setState({\n            rows: data\n          });\n        }.bind(this), function (data) {\n          console.log(data);\n        }.bind(this));\n      }\n    };\n\n    this.rowsChanged = (rows, index) => {\n      var indexOfChangedRow = index.indexes[0];\n      var oldInstanceOfChangedRow = this.state.rows[indexOfChangedRow];\n      var newInstanceOfChangedRow = rows[indexOfChangedRow];\n\n      if (!this.state.newRows.includes(indexOfChangedRow)) {\n        //Changed row is not new, so we can update right away\n        this.updateRow(oldInstanceOfChangedRow, newInstanceOfChangedRow, indexOfChangedRow);\n      } else {\n        // Row is new, so we store locally and wait for a change in row before pushing the new row\n        this.setState({\n          rowStagedForInsertion: indexOfChangedRow\n        });\n        var rows = this.state.rows;\n        rows[indexOfChangedRow] = newInstanceOfChangedRow;\n        this.setState({\n          rows: rows\n        });\n      }\n    };\n\n    this.addRow = indexOfChangedRow => {\n      var data = {\n        row: this.state.rows[indexOfChangedRow]\n      };\n      var newRowsEntryIndex = this.state.newRows.indexOf(indexOfChangedRow);\n      this.state.tableDataService.addTableData(this.props.table, data, function (data) {\n        this.state.newRows.splice(newRowsEntryIndex, 1); // Unmark row as new\n      }.bind(this), function (data) {\n        console.log(data);\n      }.bind(this));\n      this.setState({\n        rowStagedForInsertion: -1\n      }); // unset the row as staged for insertion \n    };\n\n    this.updateRow = (oldRow, newRow, index) => {\n      var data = [{\n        oldRow: oldRow,\n        newRow: newRow\n      }];\n      this.state.tableDataService.updateTableData(this.props.table, data, function (data) {\n        var rows = this.state.rows;\n        rows[index] = newRow;\n        this.setState({\n          rows: rows\n        });\n      }.bind(this), function (data) {\n        console.log(data);\n      }.bind(this));\n    };\n  }\n\n  componentDidMount() {\n    this.loadTableData();\n  }\n\n  createColumns(columns) {\n    return columns.map(col => {\n      var def = {\n        key: col.column,\n        name: col.column,\n        resizable: true,\n        nullable: col.nullable\n      };\n\n      if (col.editable) {\n        def.editor = TextEditor;\n      }\n\n      return def;\n    });\n  }\n\n  render() {\n    if (this.state.loading) {\n      return /*#__PURE__*/_jsxDEV(CircularProgress, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 75,\n        columnNumber: 21\n      }, this);\n    }\n\n    var menuItems = this.createTableContextMenuOptions();\n    console.log(menuItems);\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [this.state.alert && /*#__PURE__*/_jsxDEV(CollapsableAlert, {\n        severity: this.state.alert.severity,\n        message: this.state.alert.message\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 83,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(ContentWithContextMenu, {\n        content: /*#__PURE__*/_jsxDEV(DataGrid, {\n          columns: this.state.columns,\n          rows: this.state.rows,\n          rowGetter: i => this.state.rows[i],\n          onRowsChange: this.rowsChanged,\n          enableCellSelect: true,\n          style: {\n            resize: 'both',\n            'height': \"70vh\",\n            maxWidth: \"100%\"\n          },\n          className: \"fill-grid\",\n          minHeight: \"1000\",\n          onSelectedCellChange: this.handleCellChange\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 87,\n          columnNumber: 25\n        }, this),\n        menuItems: menuItems\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 85,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 13\n    }, this);\n  }\n\n  createTableContextMenuOptions() {\n    var options = [];\n    options.push({\n      text: \"Insert\",\n      action: this.insertEmptyRow\n    });\n    options.push({\n      text: \"Delete\",\n      action: this.deleteRow\n    });\n\n    if (this.state.newRows.includes(this.state.selectedRow)) {\n      options.push({\n        text: \"Save\",\n        action: this.saveSelectRowManually\n      });\n    }\n\n    options.push({\n      text: \"Reload\",\n      action: this.loadTableData\n    });\n    console.log(options);\n    return options;\n  }\n\n  shouldProcessStagedRowInsert(rowIdx) {\n    if (rowIdx != this.state.selectedRow && this.state.rowStagedForInsertion != -1) {\n      // Changed row selection and a row is staged for insertion\n      return this.rowStagedForInsertHasAllData();\n    }\n\n    return false;\n  }\n\n  rowStagedForInsertHasAllData() {\n    var row = this.state.rows[this.state.rowStagedForInsertion];\n    var colsRequiringValue = this.state.columns.filter(col => {\n      if (!col.nullable && col.editor && !row[col.key]) {\n        return col.key;\n      }\n    });\n\n    if (colsRequiringValue.length == 0) {\n      this.setState({\n        alert: null\n      });\n      return true;\n    }\n\n    alert = {\n      severity: \"warning\",\n      message: \"The following columns require a value before entry is stored:\" + colsRequiringValue.map(col => \" \" + col.name),\n      row: this.state.rowStagedForInsertion\n    };\n    this.setState({\n      alert: alert\n    });\n    return false;\n  }\n\n}\n\nexport default SavageTable;","map":{"version":3,"sources":["C:/Users/vincent/git/playground/src/Components/Tables/SavageTable.js"],"names":["React","DataGrid","TextEditor","TableDataService","CircularProgress","Colorize","Alert","IconButton","Collapse","Button","CloseIcon","Menu","MenuItem","Typography","CollapsableAlert","ContentWithContextMenu","SavageTable","Component","state","rows","rowStagedForInsertion","newRows","columns","loading","selectedRow","alert","tableDataService","mouseX","mouseY","loadTableData","getTableData","props","table","data","setState","createColumns","tableSchema","emptyRow","forEach","col","key","idx","push","bind","console","log","handleClick","event","preventDefault","clientX","clientY","handleClose","initialState","saveSelectRowManually","rowStagedForInsertHasAllData","addRow","handleCellChange","c","shouldProcessStagedRowInsert","rowIdx","insertEmptyRow","splice","deleteRow","row","includes","deleteTableData","rowsChanged","index","indexOfChangedRow","indexes","oldInstanceOfChangedRow","newInstanceOfChangedRow","updateRow","newRowsEntryIndex","indexOf","addTableData","oldRow","newRow","updateTableData","componentDidMount","map","def","column","name","resizable","nullable","editable","editor","render","menuItems","createTableContextMenuOptions","severity","message","i","resize","maxWidth","options","text","action","colsRequiringValue","filter","length"],"mappings":"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","sourcesContent":["import React from \"react\";\r\nimport DataGrid, { TextEditor } from \"react-data-grid\";\r\nimport \"./styles.css\";\r\nimport './react-contextmenu.css'\r\n\r\nimport TableDataService from '../../Service/TableDataServices';\r\nimport { CircularProgress } from \"@material-ui/core\";\r\nimport { Colorize } from \"@material-ui/icons\";\r\nimport Alert from '@material-ui/lab/Alert';\r\nimport IconButton from '@material-ui/core/IconButton';\r\nimport Collapse from '@material-ui/core/Collapse';\r\nimport Button from '@material-ui/core/Button';\r\nimport CloseIcon from '@material-ui/icons/Close';\r\nimport Menu from '@material-ui/core/Menu';\r\nimport MenuItem from '@material-ui/core/MenuItem';\r\nimport Typography from '@material-ui/core/Typography';\r\nimport CollapsableAlert from \"../CollapsableAlert/CollapsableAlert\";\r\nimport ContentWithContextMenu from \"../ContentWithContextMenu/ContentWithContextMenu\";\r\n\r\n\r\n\r\nclass SavageTable extends React.Component {\r\n    state = {\r\n        rows: [],\r\n        rowStagedForInsertion: -1,\r\n        newRows: [],\r\n        columns: [],\r\n        loading: true,\r\n        selectedRow: null,\r\n        alert: null,\r\n        tableDataService: new TableDataService(),\r\n        mouseX: null,\r\n        mouseY: null,\r\n    };\r\n\r\n    componentDidMount() {\r\n        this.loadTableData()\r\n    }\r\n\r\n    loadTableData = () => {\r\n        this.state.tableDataService.getTableData(this.props.table,\r\n            function (data) {\r\n                this.setState({ columns: this.createColumns(data.data.tableSchema.columns) })\r\n                this.setState({ rows: data.data.data })\r\n                this.setState({ loading: false })\r\n                var emptyRow = {}\r\n                this.state.columns.forEach(col => { emptyRow[col.key] = \"\" })\r\n                var data = this.state.rows\r\n                var idx = data.push(emptyRow) - 1\r\n                this.setState({ rows: data, newRows: [idx] })\r\n            }.bind(this),\r\n            function (data) {\r\n                console.log(data)\r\n                this.setState({ loading: false })\r\n            }.bind(this));\r\n    }\r\n\r\n    createColumns(columns) {\r\n        return columns.map(col => {\r\n            var def = {\r\n                key: col.column,\r\n                name: col.column,\r\n                resizable: true,\r\n                nullable: col.nullable\r\n            }\r\n            if (col.editable) {\r\n                def.editor = TextEditor\r\n            }\r\n            return def;\r\n        })\r\n    }\r\n\r\n    render() {\r\n        if (this.state.loading) {\r\n            return (<CircularProgress />)\r\n        }\r\n        var menuItems = this.createTableContextMenuOptions()\r\n        console.log(menuItems)\r\n        return (\r\n\r\n            <div>\r\n                {this.state.alert &&\r\n                    <CollapsableAlert severity={this.state.alert.severity} message={this.state.alert.message} />\r\n                }\r\n                <ContentWithContextMenu\r\n                    content={\r\n                        <DataGrid\r\n                            columns={this.state.columns}\r\n                            rows={this.state.rows}\r\n                            rowGetter={i => this.state.rows[i]}\r\n                            onRowsChange={this.rowsChanged}\r\n                            enableCellSelect={true}\r\n                            style={{ resize: 'both', 'height': \"70vh\", maxWidth: \"100%\" }}\r\n                            className=\"fill-grid\"\r\n                            minHeight=\"1000\"\r\n                            onSelectedCellChange={this.handleCellChange}\r\n                        />\r\n                    }\r\n                    menuItems={menuItems}\r\n                />\r\n                {/* <div onClick={this.handleClose} onContextMenu={this.handleClick} style={{ cursor: 'context-menu' }}>\r\n                    <DataGrid\r\n                        columns={this.state.columns}\r\n                        rows={this.state.rows}\r\n                        rowGetter={i => this.state.rows[i]}\r\n                        onRowsChange={this.rowsChanged}\r\n                        enableCellSelect={true}\r\n                        style={{ resize: 'both', 'height': \"70vh\", maxWidth: \"100%\" }}\r\n                        className=\"fill-grid\"\r\n                        minHeight=\"1000\"\r\n                        onSelectedCellChange={this.handleCellChange}\r\n                    />\r\n                    <Menu\r\n                        keepMounted\r\n                        open={this.state.mouseY !== null}\r\n                        onClose={this.handleClose}\r\n                        anchorReference=\"anchorPosition\"\r\n                        anchorPosition={this.state.mouseY !== null && this.state.mouseX !== null\r\n                            ? { top: this.state.mouseY, left: this.state.mouseX }\r\n                            : undefined\r\n                        }\r\n                    >\r\n                        <MenuItem onClick={this.insertEmptyRow}>Insert</MenuItem>\r\n                        <MenuItem onClick={this.deleteRow}>Delete</MenuItem>\r\n                        {this.state.newRows.includes(this.state.selectedRow) && <MenuItem onClick={this.saveSelectRowManually}>Save</MenuItem>}\r\n                        <MenuItem onClick={this.loadTableData}>Reload</MenuItem>\r\n\r\n                    </Menu>\r\n                </div> */}\r\n\r\n            </div >\r\n        );\r\n    }\r\n\r\n    createTableContextMenuOptions() {\r\n        var options = []\r\n        options.push({ text: \"Insert\", action: this.insertEmptyRow })\r\n        options.push({ text: \"Delete\", action: this.deleteRow })\r\n        if (this.state.newRows.includes(this.state.selectedRow)) {\r\n            options.push({ text: \"Save\", action: this.saveSelectRowManually })\r\n        }\r\n        options.push({ text: \"Reload\", action: this.loadTableData })\r\n        console.log(options)\r\n        return options;\r\n    }\r\n\r\n    handleClick = (event) => {\r\n        event.preventDefault();\r\n        this.setState({\r\n            mouseX: event.clientX - 2,\r\n            mouseY: event.clientY - 4,\r\n        });\r\n    };\r\n\r\n    handleClose = () => {\r\n        var initialState = {\r\n            mouseX: null,\r\n            mouseY: null,\r\n        };\r\n\r\n        this.setState(initialState);\r\n    };\r\n\r\n    saveSelectRowManually = () => {\r\n        if (this.rowStagedForInsertHasAllData()) {\r\n            this.addRow(this.state.rowStagedForInsertion)\r\n        }\r\n    }\r\n\r\n    handleCellChange = (c) => {\r\n        console.log(c)\r\n        if (this.shouldProcessStagedRowInsert(c.rowIdx)) {\r\n            console.log(\"Changed row selection and a row is staged for insertion\")\r\n            this.addRow(this.state.rowStagedForInsertion)\r\n        }\r\n        this.state.selectedRow = c.rowIdx\r\n    }\r\n\r\n    shouldProcessStagedRowInsert(rowIdx) {\r\n        if (rowIdx != this.state.selectedRow && this.state.rowStagedForInsertion != -1) { // Changed row selection and a row is staged for insertion\r\n            return this.rowStagedForInsertHasAllData()\r\n        }\r\n        return false;\r\n    }\r\n\r\n    rowStagedForInsertHasAllData() {\r\n        var row = this.state.rows[this.state.rowStagedForInsertion]\r\n        var colsRequiringValue = this.state.columns.filter(col => {\r\n            if (!col.nullable && col.editor && !row[col.key]) {\r\n                return col.key\r\n            }\r\n        })\r\n\r\n        if (colsRequiringValue.length == 0) {\r\n            this.setState({ alert: null })\r\n            return true\r\n\r\n        }\r\n\r\n        alert = {\r\n            severity: \"warning\",\r\n            message: \"The following columns require a value before entry is stored:\" + colsRequiringValue.map(col => \" \" + col.name),\r\n            row: this.state.rowStagedForInsertion\r\n        }\r\n\r\n        this.setState({ alert: alert })\r\n        return false\r\n    }\r\n\r\n\r\n    insertEmptyRow = () => {\r\n        var idx = this.state.selectedRow;\r\n\r\n        var emptyRow = {}\r\n        this.state.columns.forEach(col => { emptyRow[col.key] = \"\" })\r\n        var data = this.state.rows\r\n\r\n        data.splice(idx, 0, emptyRow) //Insert empty row at index idx\r\n        this.state.newRows.push(idx)\r\n        this.setState({ rows: data })\r\n\r\n    }\r\n\r\n    deleteRow = () => {\r\n        var idx = this.state.selectedRow\r\n        var data = { row: this.state.rows[idx] }\r\n        if (this.state.newRows.includes(idx)) {\r\n            var data = this.state.rows\r\n            data.splice(idx, 1)\r\n            this.setState({ rows: data })\r\n        }\r\n        else {\r\n            this.state.tableDataService.deleteTableData(this.props.table, data,\r\n                function (data) {\r\n                    var data = this.state.rows\r\n                    data.splice(idx, 1)\r\n                    this.setState({ rows: data })\r\n                }.bind(this),\r\n                function (data) {\r\n                    console.log(data)\r\n                }.bind(this));\r\n        }\r\n    }\r\n\r\n\r\n    rowsChanged = (rows, index) => {\r\n        var indexOfChangedRow = index.indexes[0];\r\n        var oldInstanceOfChangedRow = this.state.rows[indexOfChangedRow];\r\n        var newInstanceOfChangedRow = rows[indexOfChangedRow];\r\n\r\n        if (!this.state.newRows.includes(indexOfChangedRow)) { //Changed row is not new, so we can update right away\r\n            this.updateRow(oldInstanceOfChangedRow, newInstanceOfChangedRow, indexOfChangedRow)\r\n        }\r\n        else { // Row is new, so we store locally and wait for a change in row before pushing the new row\r\n            this.setState({ rowStagedForInsertion: indexOfChangedRow })\r\n            var rows = this.state.rows;\r\n            rows[indexOfChangedRow] = newInstanceOfChangedRow;\r\n            this.setState({ rows: rows })\r\n        }\r\n\r\n    }\r\n\r\n    addRow = (indexOfChangedRow) => {\r\n        var data = { row: this.state.rows[indexOfChangedRow] }\r\n        var newRowsEntryIndex = this.state.newRows.indexOf(indexOfChangedRow)\r\n        this.state.tableDataService.addTableData(this.props.table, data,\r\n            function (data) {\r\n                this.state.newRows.splice(newRowsEntryIndex, 1); // Unmark row as new\r\n            }.bind(this),\r\n            function (data) {\r\n                console.log(data)\r\n            }.bind(this));\r\n\r\n        this.setState({ rowStagedForInsertion: -1 }) // unset the row as staged for insertion \r\n\r\n    }\r\n\r\n    updateRow = (oldRow, newRow, index) => {\r\n        var data = [\r\n            {\r\n                oldRow: oldRow,\r\n                newRow: newRow\r\n            },\r\n        ]\r\n\r\n        this.state.tableDataService.updateTableData(this.props.table, data,\r\n            function (data) {\r\n                var rows = this.state.rows;\r\n                rows[index] = newRow;\r\n                this.setState({ rows: rows })\r\n            }.bind(this),\r\n            function (data) {\r\n                console.log(data)\r\n            }.bind(this));\r\n\r\n    }\r\n\r\n}\r\n\r\nexport default SavageTable;"]},"metadata":{},"sourceType":"module"}