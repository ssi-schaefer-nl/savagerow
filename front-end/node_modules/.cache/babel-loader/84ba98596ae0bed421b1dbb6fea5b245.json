{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\vincent\\\\git\\\\playground\\\\src\\\\Components\\\\Tables\\\\SavageTable.js\";\nimport React from \"react\";\nimport DataGrid, { TextEditor } from \"react-data-grid\";\nimport \"./styles.css\";\nimport './react-contextmenu.css';\nimport TableDataService from '../../Service/TableDataServices';\nimport { CircularProgress } from \"@material-ui/core\";\nimport { Colorize } from \"@material-ui/icons\";\nimport Alert from '@material-ui/lab/Alert';\nimport IconButton from '@material-ui/core/IconButton';\nimport Collapse from '@material-ui/core/Collapse';\nimport Button from '@material-ui/core/Button';\nimport CloseIcon from '@material-ui/icons/Close';\nimport { ContextMenu, MenuItem, ContextMenuTrigger } from 'react-contextmenu';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ID = 'ID';\nconst attributes = {\n  className: 'custom-root',\n  disabledClassName: 'custom-disabled',\n  dividerClassName: 'custom-divider',\n  selectedClassName: 'custom-selected'\n};\n\nclass Example extends React.Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      rows: [],\n      rowStagedForInsertion: -1,\n      newRows: [],\n      columns: [],\n      loading: true,\n      selectedRow: -1,\n      alert: null,\n      tableDataService: new TableDataService()\n    };\n\n    this.loadTableData = () => {\n      this.state.tableDataService.getTableData(this.props.table, function (data) {\n        this.setState({\n          columns: this.createColumns(data.data.tableSchema.columns)\n        });\n        this.setState({\n          rows: data.data.data\n        });\n        this.setState({\n          loading: false\n        });\n      }.bind(this), function (data) {\n        console.log(data);\n        this.setState({\n          loading: false\n        });\n      }.bind(this));\n    };\n\n    this.handleCellChange = c => {\n      if (this.shouldProcessStagedRowInsert(c.rowIdx)) {\n        console.log(\"Changed row selection and a row is staged for insertion\");\n        this.addRow(this.state.rowStagedForInsertion);\n      }\n\n      this.state.selectedRow = c.rowIdx;\n    };\n\n    this.insertEmptyRow = () => {\n      var idx = this.state.selectedRow;\n      var emptyRow = {};\n      this.state.columns.forEach(col => {\n        emptyRow[col.key] = \"\";\n      });\n      var data = this.state.rows;\n\n      if (idx == -1) {\n        data.push(emptyRow);\n      } else {\n        data.splice(idx, 0, emptyRow); //Insert empty row at index idx\n      }\n\n      this.setState({\n        rows: data\n      });\n      this.state.newRows.push(idx);\n    };\n\n    this.deleteRow = () => {\n      var idx = this.state.selectedRow;\n      var data = this.state.rows;\n      data.splice(idx, 1);\n      this.setState({\n        rows: data\n      });\n    };\n\n    this.rowsChanged = (rows, index) => {\n      var indexOfChangedRow = index.indexes[0];\n      var oldInstanceOfChangedRow = this.state.rows[indexOfChangedRow];\n      var newInstanceOfChangedRow = rows[indexOfChangedRow];\n\n      if (!this.state.newRows.includes(indexOfChangedRow)) {\n        //Changed row is not new, so we can update right away\n        this.updateRow(oldInstanceOfChangedRow, newInstanceOfChangedRow, indexOfChangedRow);\n      } else {\n        // Row is new, so we store locally and wait for a change in row before pushing the new row\n        this.setState({\n          rowStagedForInsertion: indexOfChangedRow\n        });\n        var rows = this.state.rows;\n        rows[indexOfChangedRow] = newInstanceOfChangedRow;\n        this.setState({\n          rows: rows\n        });\n      }\n    };\n\n    this.addRow = indexOfChangedRow => {\n      var data = {\n        newRow: this.state.rows[indexOfChangedRow]\n      };\n      console.log(data);\n      var newRowsEntryIndex = this.state.newRows.indexOf(indexOfChangedRow);\n      this.state.tableDataService.addTableData(this.props.table, data, function (data) {\n        this.state.newRows.splice(newRowsEntryIndex, 1); // Unmark row as new\n      }.bind(this), function (data) {\n        console.log(data);\n      }.bind(this));\n      this.setState({\n        rowStagedForInsertion: -1\n      }); // unset the row as staged for insertion \n    };\n\n    this.updateRow = (oldRow, newRow, index) => {\n      var data = [{\n        oldRow: oldRow,\n        newRow: newRow\n      }];\n      this.state.tableDataService.updateTableData(this.props.table, data, function (data) {\n        var rows = this.state.rows;\n        rows[index] = newRow;\n        this.setState({\n          rows: rows\n        });\n      }.bind(this), function (data) {\n        console.log(data);\n      }.bind(this));\n    };\n  }\n\n  componentDidMount() {\n    this.loadTableData();\n  }\n\n  createColumns(columns) {\n    return columns.map(col => {\n      var def = {\n        key: col.column,\n        name: col.column,\n        resizable: true,\n        nullable: col.nullable\n      };\n\n      if (col.editable) {\n        def.editor = TextEditor;\n      }\n\n      return def;\n    });\n  }\n\n  render() {\n    if (this.state.loading) {\n      return /*#__PURE__*/_jsxDEV(CircularProgress, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 75,\n        columnNumber: 21\n      }, this);\n    }\n\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(ContextMenuTrigger, {\n        id: ID,\n        children: [this.state.alert && /*#__PURE__*/_jsxDEV(Collapse, {\n          in: this.state.alert != null,\n          style: {\n            marginBottom: \"2em\"\n          },\n          children: /*#__PURE__*/_jsxDEV(Alert, {\n            severity: this.state.alert.severity,\n            action: /*#__PURE__*/_jsxDEV(IconButton, {\n              \"aria-label\": \"close\",\n              color: \"inherit\",\n              size: \"small\",\n              onClick: () => {\n                this.setState({\n                  alert: null\n                });\n              },\n              children: /*#__PURE__*/_jsxDEV(CloseIcon, {\n                fontSize: \"inherit\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 94,\n                columnNumber: 41\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 86,\n              columnNumber: 37\n            }, this),\n            children: this.state.alert.message\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 83,\n            columnNumber: 29\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 82,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(DataGrid, {\n          columns: this.state.columns,\n          rows: this.state.rows,\n          rowGetter: i => this.state.rows[i],\n          onRowsChange: this.rowsChanged // enableCellSelect={true}\n          ,\n          style: {\n            resize: 'both',\n            'height': \"70vh\",\n            maxWidth: \"100%\"\n          },\n          className: \"fill-grid\",\n          minHeight: \"1000\",\n          onSelectedCellChange: this.handleCellChange\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 103,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 80,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(ContextMenu, {\n        id: ID,\n        children: [/*#__PURE__*/_jsxDEV(MenuItem, {\n          onClick: this.insertEmptyRow,\n          attributes: attributes,\n          children: \"Insert\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 117,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(MenuItem, {\n          onClick: this.deleteRow,\n          attributes: attributes,\n          children: \"Delete\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 123,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(MenuItem, {\n          divider: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 128,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(MenuItem, {\n          onClick: this.loadTableData,\n          attributes: attributes,\n          children: \"Reload\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 129,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 116,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 13\n    }, this);\n  }\n\n  shouldProcessStagedRowInsert(rowIdx) {\n    if (rowIdx != this.state.selectedRow && this.state.rowStagedForInsertion != -1) {\n      // Changed row selection and a row is staged for insertion\n      var row = this.state.rows[this.state.rowStagedForInsertion];\n      var colsRequiringValue = this.state.columns.filter(col => {\n        if (!col.nullable && col.editor && !row[col.key]) {\n          return col.key;\n        }\n      });\n\n      if (colsRequiringValue.length == 0) {\n        this.setState({\n          alert: null\n        });\n        return true;\n      }\n\n      alert = {\n        severity: \"warning\",\n        message: \"The following columns require a value before entry is stored:\" + colsRequiringValue.map(col => \" \" + col.name),\n        row: rowIdx\n      };\n      this.setState({\n        alert: alert\n      });\n      console.log(alert);\n    }\n\n    return false;\n  }\n\n}\n\nexport default Example;","map":{"version":3,"sources":["C:/Users/vincent/git/playground/src/Components/Tables/SavageTable.js"],"names":["React","DataGrid","TextEditor","TableDataService","CircularProgress","Colorize","Alert","IconButton","Collapse","Button","CloseIcon","ContextMenu","MenuItem","ContextMenuTrigger","ID","attributes","className","disabledClassName","dividerClassName","selectedClassName","Example","Component","state","rows","rowStagedForInsertion","newRows","columns","loading","selectedRow","alert","tableDataService","loadTableData","getTableData","props","table","data","setState","createColumns","tableSchema","bind","console","log","handleCellChange","c","shouldProcessStagedRowInsert","rowIdx","addRow","insertEmptyRow","idx","emptyRow","forEach","col","key","push","splice","deleteRow","rowsChanged","index","indexOfChangedRow","indexes","oldInstanceOfChangedRow","newInstanceOfChangedRow","includes","updateRow","newRow","newRowsEntryIndex","indexOf","addTableData","oldRow","updateTableData","componentDidMount","map","def","column","name","resizable","nullable","editable","editor","render","marginBottom","severity","message","i","resize","maxWidth","row","colsRequiringValue","filter","length"],"mappings":"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","sourcesContent":["import React from \"react\";\r\nimport DataGrid, { TextEditor } from \"react-data-grid\";\r\nimport \"./styles.css\";\r\nimport './react-contextmenu.css'\r\n\r\nimport TableDataService from '../../Service/TableDataServices';\r\nimport { CircularProgress } from \"@material-ui/core\";\r\nimport { Colorize } from \"@material-ui/icons\";\r\nimport Alert from '@material-ui/lab/Alert';\r\nimport IconButton from '@material-ui/core/IconButton';\r\nimport Collapse from '@material-ui/core/Collapse';\r\nimport Button from '@material-ui/core/Button';\r\nimport CloseIcon from '@material-ui/icons/Close';\r\nimport { ContextMenu, MenuItem, ContextMenuTrigger } from 'react-contextmenu'\r\nconst ID = 'ID'\r\n\r\n\r\n\r\nconst attributes = {\r\n    className: 'custom-root',\r\n    disabledClassName: 'custom-disabled',\r\n    dividerClassName: 'custom-divider',\r\n    selectedClassName: 'custom-selected'\r\n}\r\n\r\nclass Example extends React.Component {\r\n\r\n\r\n    state = {\r\n        rows: [],\r\n        rowStagedForInsertion: -1,\r\n        newRows: [],\r\n        columns: [],\r\n        loading: true,\r\n        selectedRow: -1,\r\n        alert: null,\r\n        tableDataService: new TableDataService(),\r\n    };\r\n\r\n    componentDidMount() {\r\n        this.loadTableData()\r\n    }\r\n\r\n    loadTableData = () => {\r\n        this.state.tableDataService.getTableData(this.props.table,\r\n            function (data) {\r\n                this.setState({ columns: this.createColumns(data.data.tableSchema.columns) })\r\n                this.setState({ rows: data.data.data })\r\n                this.setState({ loading: false })\r\n            }.bind(this),\r\n            function (data) {\r\n                console.log(data)\r\n                this.setState({ loading: false })\r\n            }.bind(this));\r\n    }\r\n\r\n    createColumns(columns) {\r\n        return columns.map(col => {\r\n            var def = {\r\n                key: col.column,\r\n                name: col.column,\r\n                resizable: true,\r\n                nullable: col.nullable\r\n            }\r\n            if (col.editable) {\r\n                def.editor = TextEditor\r\n            }\r\n            return def;\r\n        })\r\n    }\r\n\r\n\r\n    render() {\r\n        if (this.state.loading) {\r\n            return (<CircularProgress />)\r\n        }\r\n\r\n        return (\r\n            <div>\r\n                <ContextMenuTrigger id={ID}>\r\n                    {this.state.alert &&\r\n                        <Collapse in={this.state.alert != null} style={{ marginBottom: \"2em\" }}>\r\n                            <Alert\r\n                                severity={this.state.alert.severity}\r\n                                action={\r\n                                    <IconButton\r\n                                        aria-label=\"close\"\r\n                                        color=\"inherit\"\r\n                                        size=\"small\"\r\n                                        onClick={() => {\r\n                                            this.setState({ alert: null })\r\n                                        }}\r\n                                    >\r\n                                        <CloseIcon fontSize=\"inherit\" />\r\n                                    </IconButton>\r\n                                }\r\n                            >\r\n                                {this.state.alert.message}\r\n                            </Alert>\r\n                        </Collapse>\r\n                    }\r\n\r\n                    <DataGrid\r\n                        columns={this.state.columns}\r\n                        rows={this.state.rows}\r\n                        rowGetter={i => this.state.rows[i]}\r\n                        onRowsChange={this.rowsChanged}\r\n                        // enableCellSelect={true}\r\n                        style={{ resize: 'both', 'height': \"70vh\", maxWidth: \"100%\" }}\r\n                        className=\"fill-grid\"\r\n                        minHeight=\"1000\"\r\n                        onSelectedCellChange={this.handleCellChange}\r\n                    />\r\n                    \r\n                </ContextMenuTrigger>\r\n                <ContextMenu id={ID}>\r\n                    <MenuItem\r\n                        onClick={this.insertEmptyRow}\r\n                        attributes={attributes}\r\n                    >\r\n                        Insert\r\n                    </MenuItem>\r\n                    <MenuItem\r\n                        onClick={this.deleteRow}\r\n                        attributes={attributes}\r\n                    >Delete\r\n                    </MenuItem>\r\n                    <MenuItem divider />\r\n                    <MenuItem\r\n                        onClick={this.loadTableData}\r\n                        attributes={attributes}\r\n                    >\r\n                        Reload  \r\n                    </MenuItem>\r\n                </ContextMenu>\r\n            </div>\r\n        );\r\n    }\r\n\r\n\r\n\r\n    handleCellChange = (c) => {\r\n        if (this.shouldProcessStagedRowInsert(c.rowIdx)) {\r\n            console.log(\"Changed row selection and a row is staged for insertion\")\r\n            this.addRow(this.state.rowStagedForInsertion)\r\n        }\r\n        this.state.selectedRow = c.rowIdx\r\n    }\r\n\r\n    shouldProcessStagedRowInsert(rowIdx) {\r\n        if (rowIdx != this.state.selectedRow && this.state.rowStagedForInsertion != -1) { // Changed row selection and a row is staged for insertion\r\n\r\n            var row = this.state.rows[this.state.rowStagedForInsertion]\r\n            var colsRequiringValue = this.state.columns.filter(col => {\r\n                if (!col.nullable && col.editor && !row[col.key]) {\r\n                    return col.key\r\n                }\r\n            })\r\n\r\n            if (colsRequiringValue.length == 0) {\r\n                this.setState({ alert: null })\r\n                return true\r\n\r\n            }\r\n\r\n            alert = {\r\n                severity: \"warning\",\r\n                message: \"The following columns require a value before entry is stored:\" + colsRequiringValue.map(col => \" \" + col.name),\r\n                row: rowIdx\r\n            }\r\n\r\n            this.setState({ alert: alert })\r\n            console.log(alert)\r\n        }\r\n        return false;\r\n    }\r\n\r\n    insertEmptyRow = () => {\r\n        var idx = this.state.selectedRow;\r\n        var emptyRow = {}\r\n        this.state.columns.forEach(col => { emptyRow[col.key] = \"\" })\r\n        var data = this.state.rows\r\n        if (idx == -1) {\r\n            data.push(emptyRow)\r\n        } else {\r\n            data.splice(idx, 0, emptyRow) //Insert empty row at index idx\r\n        }\r\n\r\n        this.setState({ rows: data })\r\n        this.state.newRows.push(idx)\r\n    }\r\n\r\n    deleteRow = () => {\r\n        var idx = this.state.selectedRow\r\n        var data = this.state.rows\r\n        data.splice(idx, 1)\r\n        this.setState({rows: data})\r\n    }\r\n\r\n\r\n    rowsChanged = (rows, index) => {\r\n        var indexOfChangedRow = index.indexes[0];\r\n        var oldInstanceOfChangedRow = this.state.rows[indexOfChangedRow];\r\n        var newInstanceOfChangedRow = rows[indexOfChangedRow];\r\n\r\n        if (!this.state.newRows.includes(indexOfChangedRow)) { //Changed row is not new, so we can update right away\r\n            this.updateRow(oldInstanceOfChangedRow, newInstanceOfChangedRow, indexOfChangedRow)\r\n        }\r\n        else { // Row is new, so we store locally and wait for a change in row before pushing the new row\r\n            this.setState({ rowStagedForInsertion: indexOfChangedRow })\r\n            var rows = this.state.rows;\r\n            rows[indexOfChangedRow] = newInstanceOfChangedRow;\r\n            this.setState({ rows: rows })\r\n        }\r\n\r\n    }\r\n\r\n    addRow = (indexOfChangedRow) => {\r\n\r\n        var data = { newRow: this.state.rows[indexOfChangedRow] }\r\n        console.log(data)\r\n        var newRowsEntryIndex = this.state.newRows.indexOf(indexOfChangedRow)\r\n\r\n        this.state.tableDataService.addTableData(this.props.table, data,\r\n            function (data) {\r\n                this.state.newRows.splice(newRowsEntryIndex, 1); // Unmark row as new\r\n            }.bind(this),\r\n            function (data) {\r\n                console.log(data)\r\n            }.bind(this));\r\n\r\n        this.setState({ rowStagedForInsertion: -1 }) // unset the row as staged for insertion \r\n\r\n    }\r\n\r\n    updateRow = (oldRow, newRow, index) => {\r\n        var data = [\r\n            {\r\n                oldRow: oldRow,\r\n                newRow: newRow\r\n            },\r\n        ]\r\n\r\n        this.state.tableDataService.updateTableData(this.props.table, data,\r\n            function (data) {\r\n                var rows = this.state.rows;\r\n                rows[index] = newRow;\r\n                this.setState({ rows: rows })\r\n            }.bind(this),\r\n            function (data) {\r\n                console.log(data)\r\n            }.bind(this));\r\n\r\n    }\r\n\r\n}\r\n\r\nexport default Example;"]},"metadata":{},"sourceType":"module"}